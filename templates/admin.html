<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - ë‚˜ì¸íŠ¸ë¦¬ í˜¸í…”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-nav {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tab {
            padding: 10px 20px;
            border: 2px solid #e1e1e1;
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .nav-tab:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .section-header {
            background-color: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e1e1e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .refresh-btn:hover {
            background: #5a6fd8;
        }

        .content-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .item {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.3s;
        }

        .item:hover {
            background-color: #f8f9fa;
        }

        .item:last-child {
            border-bottom: none;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .room-info {
            font-weight: bold;
            color: #667eea;
            font-size: 16px;
        }

        .timestamp {
            font-size: 12px;
            color: #666;
        }

        .item-content {
            margin-bottom: 10px;
        }

        .message-box {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid #667eea;
        }

        .translation-box {
            background-color: #f3e5f5;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid #9c27b0;
        }

        .ai-response-box {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
        }

        .service-request-box {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ff9800;
            position: relative;
        }

        .service-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-complete {
            background: #4caf50;
            color: white;
        }

        .btn-complete:hover {
            background: #45a049;
        }

        .btn-assign {
            background: #2196f3;
            color: white;
        }

        .btn-assign:hover {
            background: #1976d2;
        }

        .btn-urgent {
            background: #f44336;
            color: white;
        }

        .btn-urgent:hover {
            background: #d32f2f;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-received {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-ai-responded {
            background-color: #d4edda;
            color: #155724;
        }

        .status-processing {
            background-color: #cce5ff;
            color: #004085;
        }

        .status-completed {
            background-color: #d1ecf1;
            color: #0c5460;
        }

        .status-urgent {
            background-color: #f8d7da;
            color: #721c24;
        }

        .priority-high {
            border-left-color: #f44336 !important;
            background-color: #ffebee !important;
        }

        .priority-medium {
            border-left-color: #ff9800 !important;
            background-color: #fff3e0 !important;
        }

        .priority-low {
            border-left-color: #4caf50 !important;
            background-color: #e8f5e8 !important;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #666;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: #667eea;
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: left 0.3s;
        }

        .toggle.active::after {
            left: 27px;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .dashboard-nav {
                flex-direction: column;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .section-header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .item-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .service-actions {
                flex-direction: column;
            }

            .filter-controls {
                flex-direction: column;
            }
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .quick-stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .quick-stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¨ ë‚˜ì¸íŠ¸ë¦¬ í˜¸í…” ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
        <p>ì‹¤ì‹œê°„ ê³ ê° ë©”ì‹œì§€ ë° ì„œë¹„ìŠ¤ ìš”ì²­ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</p>
    </div>

    <div class="container">
        <!-- ëŒ€ì‹œë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="dashboard-nav">
            <div class="nav-tab active" onclick="showTab('overview')">ğŸ“Š ì „ì²´ í˜„í™©</div>
            <div class="nav-tab" onclick="showTab('messages')">ğŸ’¬ ë©”ì‹œì§€ ê´€ë¦¬</div>
            <div class="nav-tab" onclick="showTab('services')">ğŸ›ï¸ ì„œë¹„ìŠ¤ ìš”ì²­</div>
            <div class="nav-tab" onclick="showTab('chat-rooms')">ğŸ’» ì‹¤ì‹œê°„ ì±„íŒ…</div>
            <div class="nav-tab" onclick="showTab('analytics')">ğŸ“ˆ í†µê³„ ë¶„ì„</div>
        </div>

        <!-- ì „ì²´ í†µê³„ ì¹´ë“œë“¤ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalMessages">0</div>
                <div class="stat-label">ì´ ë©”ì‹œì§€</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="aiResponses">0</div>
                <div class="stat-label">AI ìë™ ì‘ë‹µ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="serviceRequests">0</div>
                <div class="stat-label">ì„œë¹„ìŠ¤ ìš”ì²­</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingTasks">0</div>
                <div class="stat-label">ì²˜ë¦¬ ëŒ€ê¸°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="responseRate">0%</div>
                <div class="stat-label">ì‘ë‹µë¥ </div>
            </div>
        </div>

        <!-- ì „ì²´ í˜„í™© íƒ­ -->
        <div id="overview" class="tab-content active">
            <div class="quick-stats">
                <div class="quick-stat">
                    <div class="quick-stat-number" id="todayMessages">0</div>
                    <div class="quick-stat-label">ì˜¤ëŠ˜ ë©”ì‹œì§€</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-number" id="activeChats">0</div>
                    <div class="quick-stat-label">í™œì„± ì±„íŒ…</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-number" id="urgentRequests">0</div>
                    <div class="quick-stat-label">ê¸´ê¸‰ ìš”ì²­</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-number" id="completedToday">0</div>
                    <div class="quick-stat-label">ì˜¤ëŠ˜ ì™„ë£Œ</div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸš¨ ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”</h2>
                    <button class="refresh-btn" onclick="refreshUrgentTasks()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
                <div class="content-container" id="urgentTasksContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">âœ…</div>
                        <h3>ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ëª¨ë“  ìš”ì²­ì´ ì ì ˆíˆ ì²˜ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ê´€ë¦¬ íƒ­ -->
        <div id="messages" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“± ì‹¤ì‹œê°„ ë©”ì‹œì§€</h2>
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div class="auto-refresh">
                            <span>ìë™ ìƒˆë¡œê³ ì¹¨</span>
                            <div class="toggle active" id="autoRefreshToggle"></div>
                        </div>
                        <button class="refresh-btn" onclick="refreshMessages()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
                
                <div class="filter-controls">
                    <select class="filter-select" id="languageFilter" onchange="filterMessages()">
                        <option value="">ëª¨ë“  ì–¸ì–´</option>
                        <option value="ko">í•œêµ­ì–´</option>
                        <option value="en">English</option>
                        <option value="ja">æ—¥æœ¬èª</option>
                        <option value="zh">ä¸­æ–‡</option>
                    </select>
                    <select class="filter-select" id="statusFilter" onchange="filterMessages()">
                        <option value="">ëª¨ë“  ìƒíƒœ</option>
                        <option value="received">ì ‘ìˆ˜ë¨</option>
                        <option value="ai_responded">AI ì‘ë‹µ</option>
                        <option value="needs_staff">ì§ì› í•„ìš”</option>
                        <option value="completed">ì™„ë£Œ</option>
                    </select>
                </div>
                
                <div class="content-container" id="messagesContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„œë¹„ìŠ¤ ìš”ì²­ ê´€ë¦¬ íƒ­ -->
        <div id="services" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ›ï¸ ì„œë¹„ìŠ¤ ìš”ì²­ ê´€ë¦¬</h2>
                    <button class="refresh-btn" onclick="refreshServiceRequests()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div class="filter-controls">
                    <select class="filter-select" id="priorityFilter" onchange="filterServiceRequests()">
                        <option value="">ëª¨ë“  ìš°ì„ ìˆœìœ„</option>
                        <option value="high">ë†’ìŒ</option>
                        <option value="medium">ë³´í†µ</option>
                        <option value="low">ë‚®ìŒ</option>
                    </select>
                    <select class="filter-select" id="serviceStatusFilter" onchange="filterServiceRequests()">
                        <option value="">ëª¨ë“  ìƒíƒœ</option>
                        <option value="pending">ì²˜ë¦¬ ëŒ€ê¸°</option>
                        <option value="in-progress">ì²˜ë¦¬ ì¤‘</option>
                        <option value="completed">ì™„ë£Œ</option>
                    </select>
                    <select class="filter-select" id="serviceTypeFilter" onchange="filterServiceRequests()">
                        <option value="">ëª¨ë“  ìœ í˜•</option>
                        <option value="housekeeping">í•˜ìš°ìŠ¤í‚¤í•‘</option>
                        <option value="room-service">ë£¸ì„œë¹„ìŠ¤</option>
                        <option value="maintenance">ì‹œì„¤ ê´€ë¦¬</option>
                        <option value="concierge">ì»¨ì‹œì–´ì§€</option>
                    </select>
                </div>
                
                <div class="content-container" id="serviceRequestsContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ›ï¸</div>
                        <h3>ì„œë¹„ìŠ¤ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì˜ ì„œë¹„ìŠ¤ ìš”ì²­ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ì±„íŒ… íƒ­ -->
        <div id="chat-rooms" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ’» í™œì„± ì±„íŒ…ë°©</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="refresh-btn" onclick="refreshChatRooms()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                        <button class="refresh-btn" onclick="openStaffChat()" style="background: #4caf50;">ğŸ‘¨â€ğŸ’¼ ì§ì› ì±„íŒ… ì—´ê¸°</button>
                    </div>
                </div>
                
                <div class="content-container" id="chatRoomsContainer">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¬</div>
                        <h3>í™œì„± ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì´ ì§ì› ì±„íŒ…ì„ ìš”ì²­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- í†µê³„ ë¶„ì„ íƒ­ -->
        <div id="analytics" class="tab-content">
            <div class="section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“ˆ ìš´ì˜ í†µê³„</h2>
                    <button class="refresh-btn" onclick="refreshAnalytics()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="avgResponseTime">0ë¶„</div>
                        <div class="stat-label">í‰ê·  ì‘ë‹µ ì‹œê°„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="customerSatisfaction">0%</div>
                        <div class="stat-label">ê³ ê° ë§Œì¡±ë„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="busyHours">ì˜¤í›„ 2ì‹œ</div>
                        <div class="stat-label">ìµœê³  ë°”ìœ ì‹œê°„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="topLanguage">í•œêµ­ì–´</div>
                        <div class="stat-label">ìµœë‹¤ ì‚¬ìš© ì–¸ì–´</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div class="notification" id="notification"></div>

    <script>
        let autoRefresh = true;
        let refreshInterval;
        let lastMessageCount = 0;
        let currentTab = 'overview';

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            refreshAllData();
            startAutoRefresh();
            
            // ìë™ ìƒˆë¡œê³ ì¹¨ í† ê¸€
            document.getElementById('autoRefreshToggle').addEventListener('click', toggleAutoRefresh);
        });

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ëª¨ë“  ë„¤ë¹„ê²Œì´ì…˜ íƒ­ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            currentTab = tabName;
            
            // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
            switch(tabName) {
                case 'overview':
                    refreshOverview();
                    break;
                case 'messages':
                    refreshMessages();
                    break;
                case 'services':
                    refreshServiceRequests();
                    break;
                case 'chat-rooms':
                    refreshChatRooms();
                    break;
                case 'analytics':
                    refreshAnalytics();
                    break;
            }
        }

        // ì „ì²´ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        async function refreshAllData() {
            try {
                await Promise.all([
                    refreshOverview(),
                    refreshMessages(),
                    refreshServiceRequests(),
                    refreshChatRooms()
                ]);
            } catch (error) {
                console.error('ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showNotification('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ì „ì²´ í˜„í™© ìƒˆë¡œê³ ì¹¨
        async function refreshOverview() {
            try {
                const response = await fetch('/api/messages');
                const data = await response.json();
                
                if (data.success) {
                    updateOverviewStats(data.messages);
                    updateUrgentTasks(data.messages);
                }
            } catch (error) {
                console.error('ì „ì²´ í˜„í™© ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }

        // ì „ì²´ í˜„í™© í†µê³„ ì—…ë°ì´íŠ¸
        function updateOverviewStats(messages) {
            const totalMessages = messages.length;
            const aiResponses = messages.filter(msg => msg.ai_response && !msg.requires_staff).length;
            const serviceRequests = messages.filter(msg => msg.requires_staff).length;
            const pendingTasks = messages.filter(msg => msg.status === 'needs_staff' || msg.status === 'received').length;
            const responseRate = totalMessages > 0 ? Math.round((aiResponses / totalMessages) * 100) : 0;

            document.getElementById('totalMessages').textContent = totalMessages;
            document.getElementById('aiResponses').textContent = aiResponses;
            document.getElementById('serviceRequests').textContent = serviceRequests;
            document.getElementById('pendingTasks').textContent = pendingTasks;
            document.getElementById('responseRate').textContent = responseRate + '%';

            // ë¹ ë¥¸ í†µê³„ë„ ì—…ë°ì´íŠ¸
            const today = new Date().toDateString();
            const todayMessages = messages.filter(msg => new Date(msg.timestamp).toDateString() === today).length;
            const urgentRequests = messages.filter(msg => msg.requires_staff && msg.status !== 'completed').length;
            const completedToday = messages.filter(msg => msg.status === 'completed' && new Date(msg.timestamp).toDateString() === today).length;

            document.getElementById('todayMessages').textContent = todayMessages;
            document.getElementById('urgentRequests').textContent = urgentRequests;
            document.getElementById('completedToday').textContent = completedToday;
        }

        // ê¸´ê¸‰ ì‘ì—… ì—…ë°ì´íŠ¸
        function updateUrgentTasks(messages) {
            const urgentTasks = messages.filter(msg => 
                msg.requires_staff && 
                (msg.status === 'needs_staff' || msg.status === 'received')
            );

            const container = document.getElementById('urgentTasksContainer');
            
            if (urgentTasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">âœ…</div>
                        <h3>ê¸´ê¸‰ ì²˜ë¦¬ í•„ìš”í•œ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ëª¨ë“  ìš”ì²­ì´ ì ì ˆíˆ ì²˜ë¦¬ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = urgentTasks.map(task => `
                <div class="item">
                    <div class="item-header">
                        <div class="room-info">ğŸ¨ ê°ì‹¤ ${task.room_number}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="status-badge status-urgent">ê¸´ê¸‰</span>
                            <div class="timestamp">${formatTimestamp(task.timestamp)}</div>
                        </div>
                    </div>
                    
                    <div class="item-content">
                        <div class="service-request-box priority-high">
                            <strong>ğŸš¨ ê¸´ê¸‰ ìš”ì²­:</strong><br>
                            ${task.original_message}
                            ${task.translated_message ? `<br><small>ë²ˆì—­: ${task.translated_message}</small>` : ''}
                            
                            <div class="service-actions">
                                <button class="btn btn-complete" onclick="markTaskCompleted(${task.id})">
                                    âœ… ì™„ë£Œ ì²˜ë¦¬
                                </button>
                                <button class="btn btn-assign" onclick="assignToStaff(${task.id})">
                                    ğŸ‘¨â€ğŸ’¼ ì§ì› ë°°ì •
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ë©”ì‹œì§€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        async function refreshMessages() {
            try {
                const response = await fetch('/api/messages');
                const data = await response.json();
                
                if (data.success) {
                    renderMessages(data.messages);
                    
                    // ìƒˆ ë©”ì‹œì§€ ì•Œë¦¼
                    if (data.messages.length > lastMessageCount && lastMessageCount > 0) {
                        showNotification(`ìƒˆë¡œìš´ ë©”ì‹œì§€ ${data.messages.length - lastMessageCount}ê±´ì´ ë„ì°©í–ˆìŠµë‹ˆë‹¤! ğŸ“¢`);
                    }
                    lastMessageCount = data.messages.length;
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showNotification('ë©”ì‹œì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // ë©”ì‹œì§€ ë Œë”ë§
        function renderMessages(messages) {
            const container = document.getElementById('messagesContainer');
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <h3>ì•„ì§ ë©”ì‹œì§€ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // ìµœì‹  ë©”ì‹œì§€ê°€ ìœ„ì— ì˜¤ë„ë¡ ì •ë ¬
            const sortedMessages = messages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sortedMessages.map(message => `
                <div class="item">
                    <div class="item-header">
                        <div class="room-info">ğŸ¨ ê°ì‹¤ ${message.room_number}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="status-badge status-${message.status.replace('_', '-')}">${getStatusText(message.status)}</span>
                            <div class="timestamp">${formatTimestamp(message.timestamp)}</div>
                        </div>
                    </div>
                    
                    <div class="item-content">
                        <div class="message-box">
                            <strong>ğŸ“ ì›ë³¸ ë©”ì‹œì§€:</strong><br>
                            ${message.original_message}
                        </div>
                        
                        ${message.translated_message ? `
                            <div class="translation-box">
                                <strong>ğŸ”„ ë²ˆì—­ëœ ë©”ì‹œì§€:</strong><br>
                                ${message.translated_message}
                            </div>
                        ` : ''}
                        
                        ${message.ai_response ? `
                            <div class="ai-response-box">
                                <strong>ğŸ¤– AI ì‘ë‹µ:</strong><br>
                                ${message.ai_response}
                            </div>
                        ` : ''}
                        
                        ${message.requires_staff ? `
                            <div class="service-request-box">
                                <strong>ğŸ‘¨â€ğŸ’¼ ì§ì› ì²˜ë¦¬ í•„ìš”:</strong> ì„œë¹„ìŠ¤ ìš”ì²­ í•­ëª©
                                <div class="service-actions">
                                    <button class="btn btn-complete" onclick="markTaskCompleted(${message.id})">
                                        âœ… ì™„ë£Œ
                                    </button>
                                    <button class="btn btn-assign" onclick="assignToStaff(${message.id})">
                                        ğŸ‘¨â€ğŸ’¼ ë°°ì •
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ì„œë¹„ìŠ¤ ìš”ì²­ ìƒˆë¡œê³ ì¹¨
        async function refreshServiceRequests() {
            try {
                const response = await fetch('/api/messages');
                const data = await response.json();
                
                if (data.success) {
                    const serviceRequests = data.messages.filter(msg => msg.requires_staff);
                    renderServiceRequests(serviceRequests);
                }
            } catch (error) {
                console.error('ì„œë¹„ìŠ¤ ìš”ì²­ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }

        // ì„œë¹„ìŠ¤ ìš”ì²­ ë Œë”ë§
        function renderServiceRequests(requests) {
            const container = document.getElementById('serviceRequestsContainer');
            
            if (requests.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ›ï¸</div>
                        <h3>ì„œë¹„ìŠ¤ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì˜ ì„œë¹„ìŠ¤ ìš”ì²­ì´ ìˆìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = requests.map(request => {
                const priority = getServicePriority(request.original_message);
                const serviceType = getServiceType(request.original_message);
                
                return `
                    <div class="item">
                        <div class="item-header">
                            <div class="room-info">ğŸ¨ ê°ì‹¤ ${request.room_number}</div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span class="status-badge status-${request.status.replace('_', '-')}">${getStatusText(request.status)}</span>
                                <div class="timestamp">${formatTimestamp(request.timestamp)}</div>
                            </div>
                        </div>
                        
                        <div class="item-content">
                            <div class="service-request-box priority-${priority}" data-service-type="${serviceType}" data-priority="${priority}">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <strong>ğŸ›ï¸ ${getServiceTypeText(serviceType)} ìš”ì²­</strong>
                                    <span class="status-badge" style="background: ${getPriorityColor(priority)}; color: white;">
                                        ${getPriorityText(priority)}
                                    </span>
                                </div>
                                
                                <div style="margin-bottom: 10px;">
                                    ${request.original_message}
                                    ${request.translated_message ? `<br><small>ë²ˆì—­: ${request.translated_message}</small>` : ''}
                                </div>
                                
                                <div class="service-actions">
                                    <button class="btn btn-complete" onclick="markServiceCompleted(${request.id})">
                                        âœ… ì™„ë£Œ
                                    </button>
                                    <button class="btn btn-assign" onclick="assignService(${request.id})">
                                        ğŸ‘¨â€ğŸ’¼ ë°°ì •
                                    </button>
                                    ${priority === 'low' ? `
                                        <button class="btn btn-urgent" onclick="markAsUrgent(${request.id})">
                                            ğŸš¨ ê¸´ê¸‰ìœ¼ë¡œ ë³€ê²½
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ì±„íŒ…ë°© ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        async function refreshChatRooms() {
            try {
                const response = await fetch('/api/chat-rooms');
                const data = await response.json();
                
                if (data.success) {
                    renderChatRooms(data.chat_rooms);
                    document.getElementById('activeChats').textContent = data.chat_rooms.length;
                }
            } catch (error) {
                console.error('ì±„íŒ…ë°© ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }

        // ì±„íŒ…ë°© ë Œë”ë§
        function renderChatRooms(chatRooms) {
            const container = document.getElementById('chatRoomsContainer');
            
            if (chatRooms.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ’¬</div>
                        <h3>í™œì„± ì±„íŒ…ë°©ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ê³ ê°ì´ ì§ì› ì±„íŒ…ì„ ìš”ì²­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = chatRooms.map(room => `
                <div class="item">
                    <div class="item-header">
                        <div class="room-info">ğŸ’¬ ê°ì‹¤ ${room.room_number}</div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span class="status-badge ${room.staff_sid ? 'status-completed' : 'status-processing'}">
                                ${room.staff_sid ? 'ëŒ€í™” ì¤‘' : 'ëŒ€ê¸° ì¤‘'}
                            </span>
                            <div class="timestamp">${formatTimestamp(room.created_at)}</div>
                        </div>
                    </div>
                    
                    <div class="item-content">
                        <div class="message-box">
                            <strong>ğŸŒ ì–¸ì–´:</strong> ${getLanguageName(room.language)}<br>
                            <strong>ğŸ‘¨â€ğŸ’¼ ë‹´ë‹¹ ì§ì›:</strong> ${room.staff_name || 'ë°°ì • ëŒ€ê¸°'}<br>
                            <strong>ğŸ“ ì±„íŒ…ë°© ID:</strong> ${room.room_id}
                        </div>
                        
                        <div class="service-actions">
                            ${!room.staff_sid ? `
                                <button class="btn btn-assign" onclick="joinChatRoom('${room.room_id}')">
                                    ğŸ’¬ ì±„íŒ… ì°¸ì—¬
                                </button>
                            ` : ''}
                            <button class="btn btn-complete" onclick="closeChatRoom('${room.room_id}')">
                                ğŸšª ì±„íŒ… ì¢…ë£Œ
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // í†µê³„ ë¶„ì„ ìƒˆë¡œê³ ì¹¨
        async function refreshAnalytics() {
            // ì‹¤ì œë¡œëŠ” ë” ë³µì¡í•œ ë¶„ì„ APIë¥¼ í˜¸ì¶œí•  ê²ƒì„
            // ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œ ë°ì´í„°ë¥¼ í‘œì‹œ
            document.getElementById('avgResponseTime').textContent = '2.3ë¶„';
            document.getElementById('customerSatisfaction').textContent = '94%';
            document.getElementById('busyHours').textContent = 'ì˜¤í›„ 2-4ì‹œ';
            document.getElementById('topLanguage').textContent = 'í•œêµ­ì–´';
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function getStatusText(status) {
            const statusMap = {
                'received': 'ì ‘ìˆ˜ë¨',
                'ai_responded': 'AI ì‘ë‹µ',
                'needs_staff': 'ì§ì› í•„ìš”',
                'completed': 'ì™„ë£Œ'
            };
            return statusMap[status] || status;
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            
            if (diffMins < 1) return 'ë°©ê¸ˆ ì „';
            if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)}ì‹œê°„ ì „`;
            
            return date.toLocaleDateString('ko-KR') + ' ' + date.toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
        }

        function getServicePriority(message) {
            const urgentKeywords = ['ê¸‰í•´', 'ë¹¨ë¦¬', 'ê¸´ê¸‰', 'urgent', 'asap', 'ä»Šã™ã', 'æ€¥ã', 'ç´§æ€¥', 'å¿«'];
            const lowPriorityKeywords = ['ì²œì²œíˆ', 'ë‚˜ì¤‘ì—', 'later', 'when convenient', 'å¾Œã§', 'æ…¢ç‚¹'];
            
            const messageLower = message.toLowerCase();
            
            if (urgentKeywords.some(keyword => messageLower.includes(keyword))) {
                return 'high';
            }
            if (lowPriorityKeywords.some(keyword => messageLower.includes(keyword))) {
                return 'low';
            }
            return 'medium';
        }

        function getServiceType(message) {
            const messageLower = message.toLowerCase();
            
            if (messageLower.includes('íƒ€ì˜¬') || messageLower.includes('towel') || messageLower.includes('ì²­ì†Œ') || messageLower.includes('cleaning')) {
                return 'housekeeping';
            }
            if (messageLower.includes('ìŒì‹') || messageLower.includes('food') || messageLower.includes('ë£¸ì„œë¹„ìŠ¤') || messageLower.includes('room service')) {
                return 'room-service';
            }
            if (messageLower.includes('ê³ ì¥') || messageLower.includes('ë¬¸ì œ') || messageLower.includes('repair') || messageLower.includes('broken')) {
                return 'maintenance';
            }
            return 'concierge';
        }

        function getServiceTypeText(type) {
            const typeMap = {
                'housekeeping': 'í•˜ìš°ìŠ¤í‚¤í•‘',
                'room-service': 'ë£¸ì„œë¹„ìŠ¤',
                'maintenance': 'ì‹œì„¤ê´€ë¦¬',
                'concierge': 'ì»¨ì‹œì–´ì§€'
            };
            return typeMap[type] || 'ê¸°íƒ€';
        }

        function getPriorityText(priority) {
            const priorityMap = {
                'high': 'ë†’ìŒ',
                'medium': 'ë³´í†µ',
                'low': 'ë‚®ìŒ'
            };
            return priorityMap[priority] || 'ë³´í†µ';
        }

        function getPriorityColor(priority) {
            const colorMap = {
                'high': '#f44336',
                'medium': '#ff9800',
                'low': '#4caf50'
            };
            return colorMap[priority] || '#ff9800';
        }

        function getLanguageName(lang) {
            const langMap = {
                'ko': 'í•œêµ­ì–´ ğŸ‡°ğŸ‡·',
                'en': 'English ğŸ‡ºğŸ‡¸',
                'ja': 'æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ',
                'zh': 'ä¸­æ–‡ ğŸ‡¨ğŸ‡³'
            };
            return langMap[lang] || lang;
        }

        // âœ… ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜ - ì‹¤ì œ API í˜¸ì¶œ êµ¬í˜„
        async function markTaskCompleted(taskId) {
            if (confirm('ì´ ì‘ì—…ì„ ì™„ë£Œë¡œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const response = await fetch(`/api/service-requests/${taskId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            status: 'completed',
                            assigned_staff: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì'
                        })
                    });

                    const result = await response.json();
            
                    if (result.success) {
                        showNotification('ì‘ì—…ì´ ì™„ë£Œë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                        // ğŸ”„ ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            refreshAllData();
                        }, 500);
                    } else {
                        showNotification('ì‘ì—… ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ì™„ë£Œ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    showNotification('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // âœ… ì„œë¹„ìŠ¤ ì™„ë£Œ ì²˜ë¦¬ í•¨ìˆ˜ - ì‹¤ì œ API í˜¸ì¶œ êµ¬í˜„
        async function markServiceCompleted(serviceId) {
            if (confirm('ì´ ì„œë¹„ìŠ¤ ìš”ì²­ì„ ì™„ë£Œë¡œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const response = await fetch(`/api/service-requests/${serviceId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            status: 'completed',
                            assigned_staff: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì'
                        })
                    });

                    const result = await response.json();
            
                    if (result.success) {
                        showNotification('ì„œë¹„ìŠ¤ ìš”ì²­ì´ ì™„ë£Œë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                        // ğŸ”„ ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            refreshServiceRequests();
                            refreshOverview(); // í†µê³„ë„ í•¨ê»˜ ì—…ë°ì´íŠ¸
                        }, 500);
                    } else {
                        showNotification('ì„œë¹„ìŠ¤ ì™„ë£Œ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ì„œë¹„ìŠ¤ ì™„ë£Œ ì˜¤ë¥˜:', error);
                    showNotification('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // âœ… ì§ì› ë°°ì • í•¨ìˆ˜ - ì‹¤ì œ API í˜¸ì¶œ êµ¬í˜„
        async function assignToStaff(taskId) {
            const staffName = prompt('ë‹´ë‹¹ ì§ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (staffName && staffName.trim()) {
                try {
                    const response = await fetch(`/api/service-requests/${taskId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            status: 'in-progress',
                            assigned_staff: staffName.trim()
                        })
                    });

                    const result = await response.json();
            
                    if (result.success) {
                        showNotification(`${staffName}ì—ê²Œ ì‘ì—…ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                        // ğŸ”„ ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            refreshAllData();
                        }, 500);
                    } else {
                        showNotification('ì§ì› ë°°ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ì§ì› ë°°ì • ì˜¤ë¥˜:', error);
                    showNotification('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // âœ… ì„œë¹„ìŠ¤ ë°°ì • í•¨ìˆ˜ - ì‹¤ì œ API í˜¸ì¶œ êµ¬í˜„
        async function assignService(serviceId) {
            const staffName = prompt('ë‹´ë‹¹ ì§ì› ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:');
            if (staffName && staffName.trim()) {
                try {
                    const response = await fetch(`/api/service-requests/${serviceId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            status: 'in-progress',
                            assigned_staff: staffName.trim()
                        })
                    });

                    const result = await response.json();
            
                    if (result.success) {
                        showNotification(`${staffName}ì—ê²Œ ì„œë¹„ìŠ¤ê°€ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                
                        // ğŸ”„ ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            refreshServiceRequests();
                            refreshOverview();
                        }, 500);
                    } else {
                        showNotification('ì„œë¹„ìŠ¤ ë°°ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ì„œë¹„ìŠ¤ ë°°ì • ì˜¤ë¥˜:', error);
                    showNotification('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // âœ… ê¸´ê¸‰ ì²˜ë¦¬ í•¨ìˆ˜ - ì‹¤ì œ API í˜¸ì¶œ êµ¬í˜„
        async function markAsUrgent(serviceId) {
            if (confirm('ì´ ì„œë¹„ìŠ¤ ìš”ì²­ì„ ê¸´ê¸‰ìœ¼ë¡œ ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // ğŸš¨ ìš°ì„ ìˆœìœ„ë¥¼ highë¡œ ë³€ê²½í•˜ëŠ” APIê°€ ì—†ìœ¼ë¯€ë¡œ ì„ì‹œë¡œ status ë³€ê²½
                    const response = await fetch(`/api/service-requests/${serviceId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            status: 'urgent',
                            assigned_staff: 'ê¸´ê¸‰ ì²˜ë¦¬ ëŒ€ê¸°'
                        })
                    });

                    const result = await response.json();
            
                    if (result.success) {
                        showNotification('ì„œë¹„ìŠ¤ ìš”ì²­ì´ ê¸´ê¸‰ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                        // ğŸ”„ ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                        setTimeout(() => {
                            refreshServiceRequests();
                            refreshOverview();
                        }, 500);
                    } else {
                        showNotification('ê¸´ê¸‰ ì²˜ë¦¬ ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                } catch (error) {
                    console.error('ê¸´ê¸‰ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                    showNotification('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        function joinChatRoom(roomId) {
            window.open(`/staff-chat?room_id=${roomId}`, '_blank');
        }

        function closeChatRoom(roomId) {
            if (confirm('ì´ ì±„íŒ…ë°©ì„ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // TODO: API í˜¸ì¶œë¡œ ì±„íŒ…ë°© ì¢…ë£Œ
                console.log('ì±„íŒ…ë°© ì¢…ë£Œ:', roomId);
                showNotification('ì±„íŒ…ë°©ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                setTimeout(() => refreshChatRooms(), 1000);
            }
        }

        function openStaffChat() {
            window.open('/staff-chat', '_blank');
        }

        // í•„í„°ë§ í•¨ìˆ˜ë“¤
        function filterMessages() {
            const languageFilter = document.getElementById('languageFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            // TODO: í•„í„° ì ìš© ë¡œì§ êµ¬í˜„
            console.log('ë©”ì‹œì§€ í•„í„°:', languageFilter, statusFilter);
        }

        function filterServiceRequests() {
            const priorityFilter = document.getElementById('priorityFilter').value;
            const statusFilter = document.getElementById('serviceStatusFilter').value;
            const typeFilter = document.getElementById('serviceTypeFilter').value;
            
            const items = document.querySelectorAll('#serviceRequestsContainer .item');
            
            items.forEach(item => {
                const serviceBox = item.querySelector('.service-request-box');
                if (!serviceBox) return;
                
                const priority = serviceBox.dataset.priority;
                const serviceType = serviceBox.dataset.serviceType;
                
                let show = true;
                
                if (priorityFilter && priority !== priorityFilter) show = false;
                if (typeFilter && serviceType !== typeFilter) show = false;
                
                item.style.display = show ? 'block' : 'none';
            });
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // ìë™ ìƒˆë¡œê³ ì¹¨ ê´€ë¦¬
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            
            if (autoRefresh) {
                refreshInterval = setInterval(() => {
                    if (currentTab === 'overview') refreshOverview();
                    else if (currentTab === 'messages') refreshMessages();
                    else if (currentTab === 'services') refreshServiceRequests();
                    else if (currentTab === 'chat-rooms') refreshChatRooms();
                }, 5000); // 5ì´ˆë§ˆë‹¤
            }
        }

        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const toggle = document.getElementById('autoRefreshToggle');
            
            if (autoRefresh) {
                toggle.classList.add('active');
                startAutoRefresh();
                showNotification('ìë™ ìƒˆë¡œê³ ì¹¨ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
                toggle.classList.remove('active');
                clearInterval(refreshInterval);
                showNotification('ìë™ ìƒˆë¡œê³ ì¹¨ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ ìë™ ìƒˆë¡œê³ ì¹¨ ì¡°ì ˆ
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                clearInterval(refreshInterval);
            } else if (autoRefresh) {
                startAutoRefresh();
                refreshAllData(); // í˜ì´ì§€ë¡œ ëŒì•„ì™”ì„ ë•Œ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
            }
        });

        // ê¸´ê¸‰ ì‘ì—… ìƒˆë¡œê³ ì¹¨
        function refreshUrgentTasks() {
            refreshOverview();
        }
    </script>
</body>
</html>